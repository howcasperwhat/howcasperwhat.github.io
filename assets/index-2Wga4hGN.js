function B(t,e,s){if(t&&t.length){const[n,a]=e,i=Math.PI/180*s,h=Math.cos(i),r=Math.sin(i);for(const l of t){const[o,c]=l;l[0]=(o-n)*h-(c-a)*r+n,l[1]=(o-n)*r+(c-a)*h+a}}}function Lt(t,e,s){const n=[];t.forEach(a=>n.push(...a)),B(n,e,s)}function wt(t,e){return t[0]===e[0]&&t[1]===e[1]}function At(t,e,s,n=1){const a=s,i=Math.max(e,.1),h=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,r=[0,0];if(a)for(const o of h)B(o,r,a);const l=zt(h,i,n);if(a){for(const o of h)B(o,r,-a);Lt(l,r,-a)}return l}function zt(t,e,s){const n=[];for(const o of t){const c=[...o];wt(c[0],c[c.length-1])||c.push([c[0][0],c[0][1]]),c.length>2&&n.push(c)}const a=[];e=Math.max(e,.1);const i=[];for(const o of n)for(let c=0;c<o.length-1;c++){const u=o[c],p=o[c+1];if(u[1]!==p[1]){const f=Math.min(u[1],p[1]);i.push({ymin:f,ymax:Math.max(u[1],p[1]),x:f===u[1]?u[0]:p[0],islope:(p[0]-u[0])/(p[1]-u[1])})}}if(i.sort((o,c)=>o.ymin<c.ymin?-1:o.ymin>c.ymin?1:o.x<c.x?-1:o.x>c.x?1:o.ymax===c.ymax?0:(o.ymax-c.ymax)/Math.abs(o.ymax-c.ymax)),!i.length)return a;let h=[],r=i[0].ymin,l=0;for(;h.length||i.length;){if(i.length){let o=-1;for(let u=0;u<i.length&&!(i[u].ymin>r);u++)o=u;i.splice(0,o+1).forEach(u=>{h.push({s:r,edge:u})})}if(h=h.filter(o=>!(o.edge.ymax<=r)),h.sort((o,c)=>o.edge.x===c.edge.x?0:(o.edge.x-c.edge.x)/Math.abs(o.edge.x-c.edge.x)),(s!==1||l%e===0)&&h.length>1)for(let o=0;o<h.length;o=o+2){const c=o+1;if(c>=h.length)break;const u=h[o].edge,p=h[c].edge;a.push([[Math.round(u.x),r],[Math.round(p.x),r]])}r+=s,h.forEach(o=>{o.edge.x=o.edge.x+s*o.edge.islope}),l++}return a}function E(t,e){var s;const n=e.hachureAngle+90;let a=e.hachureGap;a<0&&(a=e.strokeWidth*4),a=Math.round(Math.max(a,.1));let i=1;return e.roughness>=1&&(((s=e.randomizer)===null||s===void 0?void 0:s.next())||Math.random())>.7&&(i=a),At(t,a,n,i||1)}var K=class{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const s=E(t,e);return{type:"fillSketch",ops:this.renderLines(s,e)}}renderLines(t,e){const s=[];for(const n of t)s.push(...this.helper.doubleLineOps(n[0][0],n[0][1],n[1][0],n[1][1],e));return s}};function V(t){const e=t[0],s=t[1];return Math.sqrt(Math.pow(e[0]-s[0],2)+Math.pow(e[1]-s[1],2))}var Ct=class extends K{fillPolygons(t,e){let s=e.hachureGap;s<0&&(s=e.strokeWidth*4),s=Math.max(s,.1);const n=Object.assign({},e,{hachureGap:s}),a=E(t,n),i=Math.PI/180*e.hachureAngle,h=[],r=s*.5*Math.cos(i),l=s*.5*Math.sin(i);for(const[c,u]of a)V([c,u])&&h.push([[c[0]-r,c[1]+l],[...u]],[[c[0]+r,c[1]-l],[...u]]);return{type:"fillSketch",ops:this.renderLines(h,e)}}},It=class extends K{fillPolygons(t,e){const s=this._fillPolygons(t,e),n=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),a=this._fillPolygons(t,n);return s.ops=s.ops.concat(a.ops),s}},Et=class{constructor(t){this.helper=t}fillPolygons(t,e){e=Object.assign({},e,{hachureAngle:0});const s=E(t,e);return this.dotsOnLines(s,e)}dotsOnLines(t,e){const s=[];let n=e.hachureGap;n<0&&(n=e.strokeWidth*4),n=Math.max(n,.1);let a=e.fillWeight;a<0&&(a=e.strokeWidth/2);const i=n/4;for(const h of t){const r=V(h),l=r/n,o=Math.ceil(l)-1,c=r-o*n,u=(h[0][0]+h[1][0])/2-n/4,p=Math.min(h[0][1],h[1][1]);for(let f=0;f<o;f++){const d=p+c+f*n,M=u-i+Math.random()*2*i,k=d-i+Math.random()*2*i,m=this.helper.ellipse(M,k,a,a,e);s.push(...m.ops)}}return{type:"fillSketch",ops:s}}},$t=class{constructor(t){this.helper=t}fillPolygons(t,e){const s=E(t,e);return{type:"fillSketch",ops:this.dashedLine(s,e)}}dashedLine(t,e){const s=e.dashOffset<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashOffset,n=e.dashGap<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashGap,a=[];return t.forEach(i=>{const h=V(i),r=Math.floor(h/(s+n)),l=(h+n-r*(s+n))/2;let o=i[0],c=i[1];o[0]>c[0]&&(o=i[1],c=i[0]);const u=Math.atan((c[1]-o[1])/(c[0]-o[0]));for(let p=0;p<r;p++){const f=p*(s+n),d=f+s,M=[o[0]+f*Math.cos(u)+l*Math.cos(u),o[1]+f*Math.sin(u)+l*Math.sin(u)],k=[o[0]+d*Math.cos(u)+l*Math.cos(u),o[1]+d*Math.sin(u)+l*Math.sin(u)];a.push(...this.helper.doubleLineOps(M[0],M[1],k[0],k[1],e))}}),a}},xt=class{constructor(t){this.helper=t}fillPolygons(t,e){const s=e.hachureGap<0?e.strokeWidth*4:e.hachureGap,n=e.zigzagOffset<0?s:e.zigzagOffset;e=Object.assign({},e,{hachureGap:s+n});const a=E(t,e);return{type:"fillSketch",ops:this.zigzagLines(a,n,e)}}zigzagLines(t,e,s){const n=[];return t.forEach(a=>{const i=V(a),h=Math.round(i/(2*e));let r=a[0],l=a[1];r[0]>l[0]&&(r=a[1],l=a[0]);const o=Math.atan((l[1]-r[1])/(l[0]-r[0]));for(let c=0;c<h;c++){const u=c*2*e,p=(c+1)*2*e,f=Math.sqrt(2*Math.pow(e,2)),d=[r[0]+u*Math.cos(o),r[1]+u*Math.sin(o)],M=[r[0]+p*Math.cos(o),r[1]+p*Math.sin(o)],k=[d[0]+f*Math.cos(o+Math.PI/4),d[1]+f*Math.sin(o+Math.PI/4)];n.push(...this.helper.doubleLineOps(d[0],d[1],k[0],k[1],s),...this.helper.doubleLineOps(k[0],k[1],M[0],M[1],s))}}),n}},v={};function Ft(t,e){let s=t.fillStyle||"hachure";if(!v[s])switch(s){case"zigzag":v[s]||(v[s]=new Ct(e));break;case"cross-hatch":v[s]||(v[s]=new It(e));break;case"dots":v[s]||(v[s]=new Et(e));break;case"dashed":v[s]||(v[s]=new $t(e));break;case"zigzag-line":v[s]||(v[s]=new xt(e));break;case"hachure":default:s="hachure",v[s]||(v[s]=new K(e));break}return v[s]}function Gt(){return Math.floor(Math.random()*2**31)}var Rt=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}},qt=0,Q=1,Mt=2,x={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Wt(t){const e=new Array;for(;t!=="";)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:qt,text:RegExp.$1},t=t.substr(RegExp.$1.length);else if(t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))e[e.length]={type:Q,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length);else return[];return e[e.length]={type:Mt,text:""},e}function j(t,e){return t.type===e}function tt(t){const e=[],s=Wt(t);let n="BOD",a=0,i=s[a];for(;!j(i,Mt);){let h=0;const r=[];if(n==="BOD")if(i.text==="M"||i.text==="m")a++,h=x[i.text],n=i.text;else return tt("M0,0"+t);else j(i,Q)?h=x[n]:(a++,h=x[i.text],n=i.text);if(a+h<s.length){for(let l=a;l<a+h;l++){const o=s[l];if(j(o,Q))r[r.length]=+o.text;else throw new Error("Param not a number: "+n+","+o.text)}if(typeof x[n]=="number"){const l={key:n,data:r};e.push(l),a+=h,i=s[a],n==="M"&&(n="L"),n==="m"&&(n="l")}else throw new Error("Bad segment: "+n)}else throw new Error("Path data ended short")}return e}function kt(t){let e=0,s=0,n=0,a=0;const i=[];for(const{key:h,data:r}of t)switch(h){case"M":i.push({key:"M",data:[...r]}),[e,s]=r,[n,a]=r;break;case"m":e+=r[0],s+=r[1],i.push({key:"M",data:[e,s]}),n=e,a=s;break;case"L":i.push({key:"L",data:[...r]}),[e,s]=r;break;case"l":e+=r[0],s+=r[1],i.push({key:"L",data:[e,s]});break;case"C":i.push({key:"C",data:[...r]}),e=r[4],s=r[5];break;case"c":{const l=r.map((o,c)=>c%2?o+s:o+e);i.push({key:"C",data:l}),e=l[4],s=l[5];break}case"Q":i.push({key:"Q",data:[...r]}),e=r[2],s=r[3];break;case"q":{const l=r.map((o,c)=>c%2?o+s:o+e);i.push({key:"Q",data:l}),e=l[2],s=l[3];break}case"A":i.push({key:"A",data:[...r]}),e=r[5],s=r[6];break;case"a":e+=r[5],s+=r[6],i.push({key:"A",data:[r[0],r[1],r[2],r[3],r[4],e,s]});break;case"H":i.push({key:"H",data:[...r]}),e=r[0];break;case"h":e+=r[0],i.push({key:"H",data:[e]});break;case"V":i.push({key:"V",data:[...r]}),s=r[0];break;case"v":s+=r[0],i.push({key:"V",data:[s]});break;case"S":i.push({key:"S",data:[...r]}),e=r[2],s=r[3];break;case"s":{const l=r.map((o,c)=>c%2?o+s:o+e);i.push({key:"S",data:l}),e=l[2],s=l[3];break}case"T":i.push({key:"T",data:[...r]}),e=r[0],s=r[1];break;case"t":e+=r[0],s+=r[1],i.push({key:"T",data:[e,s]});break;case"Z":case"z":i.push({key:"Z",data:[]}),e=n,s=a;break}return i}function mt(t){const e=[];let s="",n=0,a=0,i=0,h=0,r=0,l=0;for(const{key:o,data:c}of t){switch(o){case"M":e.push({key:"M",data:[...c]}),[n,a]=c,[i,h]=c;break;case"C":e.push({key:"C",data:[...c]}),n=c[4],a=c[5],r=c[2],l=c[3];break;case"L":e.push({key:"L",data:[...c]}),[n,a]=c;break;case"H":n=c[0],e.push({key:"L",data:[n,a]});break;case"V":a=c[0],e.push({key:"L",data:[n,a]});break;case"S":{let u=0,p=0;s==="C"||s==="S"?(u=n+(n-r),p=a+(a-l)):(u=n,p=a),e.push({key:"C",data:[u,p,...c]}),r=c[0],l=c[1],n=c[2],a=c[3];break}case"T":{const[u,p]=c;let f=0,d=0;s==="Q"||s==="T"?(f=n+(n-r),d=a+(a-l)):(f=n,d=a);const M=n+2*(f-n)/3,k=a+2*(d-a)/3,m=u+2*(f-u)/3,P=p+2*(d-p)/3;e.push({key:"C",data:[M,k,m,P,u,p]}),r=f,l=d,n=u,a=p;break}case"Q":{const[u,p,f,d]=c,M=n+2*(u-n)/3,k=a+2*(p-a)/3,m=f+2*(u-f)/3,P=d+2*(p-d)/3;e.push({key:"C",data:[M,k,m,P,f,d]}),r=u,l=p,n=f,a=d;break}case"A":{const u=Math.abs(c[0]),p=Math.abs(c[1]),f=c[2],d=c[3],M=c[4],k=c[5],m=c[6];u===0||p===0?(e.push({key:"C",data:[n,a,k,m,k,m]}),n=k,a=m):(n!==k||a!==m)&&(bt(n,a,k,m,u,p,f,d,M).forEach(function(H){e.push({key:"C",data:H})}),n=k,a=m);break}case"Z":e.push({key:"Z",data:[]}),n=i,a=h;break}s=o}return e}function Dt(t){return Math.PI*t/180}function C(t,e,s){const n=t*Math.cos(s)-e*Math.sin(s),a=t*Math.sin(s)+e*Math.cos(s);return[n,a]}function bt(t,e,s,n,a,i,h,r,l,o){const c=Dt(h);let u=[],p=0,f=0,d=0,M=0;if(o)[p,f,d,M]=o;else{[t,e]=C(t,e,-c),[s,n]=C(s,n,-c);const O=(t-s)/2,b=(e-n)/2;let T=O*O/(a*a)+b*b/(i*i);T>1&&(T=Math.sqrt(T),a=T*a,i=T*i);const $=r===l?-1:1,A=a*a,Z=i*i,Tt=A*Z-A*b*b-Z*O*O,_t=A*b*b+Z*O*O,ht=$*Math.sqrt(Math.abs(Tt/_t));d=ht*a*b/i+(t+s)/2,M=ht*-i*O/a+(e+n)/2,p=Math.asin(parseFloat(((e-M)/i).toFixed(9))),f=Math.asin(parseFloat(((n-M)/i).toFixed(9))),t<d&&(p=Math.PI-p),s<d&&(f=Math.PI-f),p<0&&(p=Math.PI*2+p),f<0&&(f=Math.PI*2+f),l&&p>f&&(p=p-Math.PI*2),!l&&f>p&&(f=f-Math.PI*2)}let k=f-p;if(Math.abs(k)>Math.PI*120/180){const O=f,b=s,T=n;l&&f>p?f=p+Math.PI*120/180*1:f=p+Math.PI*120/180*-1,s=d+a*Math.cos(f),n=M+i*Math.sin(f),u=bt(s,n,b,T,a,i,h,0,l,[f,O,d,M])}k=f-p;const m=Math.cos(p),P=Math.sin(p),H=Math.cos(f),Ot=Math.sin(f),et=Math.tan(k/4),st=4/3*a*et,nt=4/3*i*et,at=[t,e],w=[t+st*P,e-nt*m],it=[s+st*Ot,n-nt*H],rt=[s,n];if(w[0]=2*at[0]-w[0],w[1]=2*at[1]-w[1],o)return[w,it,rt].concat(u);{u=[w,it,rt].concat(u);const O=[];for(let b=0;b<u.length;b+=3){const T=C(u[b][0],u[b][1],c),$=C(u[b+1][0],u[b+1][1],c),A=C(u[b+2][0],u[b+2][1],c);O.push([T[0],T[1],$[0],$[1],A[0],A[1]])}return O}}var Vt={randOffset:Bt,randOffsetWithRange:Qt,ellipse:jt,doubleLineOps:Ut};function Pt(t,e,s,n,a){return{type:"path",ops:_(t,e,s,n,a)}}function G(t,e,s){const n=(t||[]).length;if(n>2){const a=[];for(let i=0;i<n-1;i++)a.push(..._(t[i][0],t[i][1],t[i+1][0],t[i+1][1],s));return e&&a.push(..._(t[n-1][0],t[n-1][1],t[0][0],t[0][1],s)),{type:"path",ops:a}}else if(n===2)return Pt(t[0][0],t[0][1],t[1][0],t[1][1],s);return{type:"path",ops:[]}}function Ht(t,e){return G(t,!0,e)}function Zt(t,e,s,n,a){const i=[[t,e],[t+s,e],[t+s,e+n],[t,e+n]];return Ht(i,a)}function ot(t,e){if(t.length){const n=typeof t[0][0]=="number"?[t]:t,a=F(n[0],1*(1+e.roughness*.2),e),i=e.disableMultiStroke?[]:F(n[0],1.5*(1+e.roughness*.22),ut(e));for(let h=1;h<n.length;h++){const r=n[h];if(r.length){const l=F(r,1*(1+e.roughness*.2),e),o=e.disableMultiStroke?[]:F(r,1.5*(1+e.roughness*.22),ut(e));for(const c of l)c.op!=="move"&&a.push(c);for(const c of o)c.op!=="move"&&i.push(c)}}return{type:"path",ops:a.concat(i)}}return{type:"path",ops:[]}}function jt(t,e,s,n,a){const i=vt(s,n,a);return U(t,e,a,i).opset}function vt(t,e,s){const n=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),a=Math.ceil(Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*n)),i=Math.PI*2/a;let h=Math.abs(t/2),r=Math.abs(e/2);const l=1-s.curveFitting;return h+=g(h*l,s),r+=g(r*l,s),{increment:i,rx:h,ry:r}}function U(t,e,s,n){const[a,i]=ft(n.increment,t,e,n.rx,n.ry,1,n.increment*q(.1,q(.4,1,s),s),s);let h=W(a,null,s);if(!s.disableMultiStroke&&s.roughness!==0){const[r]=ft(n.increment,t,e,n.rx,n.ry,1.5,0,s),l=W(r,null,s);h=h.concat(l)}return{estimatedPoints:i,opset:{type:"path",ops:h}}}function ct(t,e,s,n,a,i,h,r,l){const o=t,c=e;let u=Math.abs(s/2),p=Math.abs(n/2);u+=g(u*.01,l),p+=g(p*.01,l);let f=a,d=i;for(;f<0;)f+=Math.PI*2,d+=Math.PI*2;d-f>Math.PI*2&&(f=0,d=Math.PI*2);const M=Math.PI*2/l.curveStepCount,k=Math.min(M/2,(d-f)/2),m=pt(k,o,c,u,p,f,d,1,l);if(!l.disableMultiStroke){const P=pt(k,o,c,u,p,f,d,1.5,l);m.push(...P)}return h&&(r?m.push(..._(o,c,o+u*Math.cos(f),c+p*Math.sin(f),l),..._(o,c,o+u*Math.cos(d),c+p*Math.sin(d),l)):m.push({op:"lineTo",data:[o,c]},{op:"lineTo",data:[o+u*Math.cos(f),c+p*Math.sin(f)]})),{type:"path",ops:m}}function lt(t,e){const s=mt(kt(tt(t))),n=[];let a=[0,0],i=[0,0];for(const{key:h,data:r}of s)switch(h){case"M":{i=[r[0],r[1]],a=[r[0],r[1]];break}case"L":n.push(..._(i[0],i[1],r[0],r[1],e)),i=[r[0],r[1]];break;case"C":{const[l,o,c,u,p,f]=r;n.push(...Yt(l,o,c,u,p,f,i,e)),i=[p,f];break}case"Z":n.push(..._(i[0],i[1],a[0],a[1],e)),i=[a[0],a[1]];break}return{type:"path",ops:n}}function N(t,e){const s=[];for(const n of t)if(n.length){const a=e.maxRandomnessOffset||0,i=n.length;if(i>2){s.push({op:"move",data:[n[0][0]+g(a,e),n[0][1]+g(a,e)]});for(let h=1;h<i;h++)s.push({op:"lineTo",data:[n[h][0]+g(a,e),n[h][1]+g(a,e)]})}}return{type:"fillPath",ops:s}}function z(t,e){return Ft(e,Vt).fillPolygons(t,e)}function Nt(t,e,s,n,a,i,h){const r=t,l=e;let o=Math.abs(s/2),c=Math.abs(n/2);o+=g(o*.01,h),c+=g(c*.01,h);let u=a,p=i;for(;u<0;)u+=Math.PI*2,p+=Math.PI*2;p-u>Math.PI*2&&(u=0,p=Math.PI*2);const f=(p-u)/h.curveStepCount,d=[];for(let M=u;M<=p;M=M+f)d.push([r+o*Math.cos(M),l+c*Math.sin(M)]);return d.push([r+o*Math.cos(p),l+c*Math.sin(p)]),d.push([r,l]),z([d],h)}function Bt(t,e){return g(t,e)}function Qt(t,e,s){return q(t,e,s)}function Ut(t,e,s,n,a){return _(t,e,s,n,a,!0)}function ut(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}function yt(t){return t.randomizer||(t.randomizer=new Rt(t.seed||0)),t.randomizer.next()}function q(t,e,s,n=1){return s.roughness*n*(yt(s)*(e-t)+t)}function g(t,e,s=1){return q(-t,t,e,s)}function _(t,e,s,n,a,i=!1){const h=i?a.disableMultiStrokeFill:a.disableMultiStroke,r=Y(t,e,s,n,a,!0,!1);if(h)return r;const l=Y(t,e,s,n,a,!0,!0);return r.concat(l)}function Y(t,e,s,n,a,i,h){const r=Math.pow(t-s,2)+Math.pow(e-n,2),l=Math.sqrt(r);let o=1;l<200?o=1:l>500?o=.4:o=-.0016668*l+1.233334;let c=a.maxRandomnessOffset||0;c*c*100>r&&(c=l/10);const u=c/2,p=.2+yt(a)*.2;let f=a.bowing*a.maxRandomnessOffset*(n-e)/200,d=a.bowing*a.maxRandomnessOffset*(t-s)/200;f=g(f,a,o),d=g(d,a,o);const M=[],k=()=>g(u,a,o),m=()=>g(c,a,o),P=a.preserveVertices;return h?M.push({op:"move",data:[t+(P?0:k()),e+(P?0:k())]}):M.push({op:"move",data:[t+(P?0:g(c,a,o)),e+(P?0:g(c,a,o))]}),h?M.push({op:"bcurveTo",data:[f+t+(s-t)*p+k(),d+e+(n-e)*p+k(),f+t+2*(s-t)*p+k(),d+e+2*(n-e)*p+k(),s+(P?0:k()),n+(P?0:k())]}):M.push({op:"bcurveTo",data:[f+t+(s-t)*p+m(),d+e+(n-e)*p+m(),f+t+2*(s-t)*p+m(),d+e+2*(n-e)*p+m(),s+(P?0:m()),n+(P?0:m())]}),M}function F(t,e,s){if(!t.length)return[];const n=[];n.push([t[0][0]+g(e,s),t[0][1]+g(e,s)]),n.push([t[0][0]+g(e,s),t[0][1]+g(e,s)]);for(let a=1;a<t.length;a++)n.push([t[a][0]+g(e,s),t[a][1]+g(e,s)]),a===t.length-1&&n.push([t[a][0]+g(e,s),t[a][1]+g(e,s)]);return W(n,null,s)}function W(t,e,s){const n=t.length,a=[];if(n>3){const i=[],h=1-s.curveTightness;a.push({op:"move",data:[t[1][0],t[1][1]]});for(let r=1;r+2<n;r++){const l=t[r];i[0]=[l[0],l[1]],i[1]=[l[0]+(h*t[r+1][0]-h*t[r-1][0])/6,l[1]+(h*t[r+1][1]-h*t[r-1][1])/6],i[2]=[t[r+1][0]+(h*t[r][0]-h*t[r+2][0])/6,t[r+1][1]+(h*t[r][1]-h*t[r+2][1])/6],i[3]=[t[r+1][0],t[r+1][1]],a.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}}else n===3?(a.push({op:"move",data:[t[1][0],t[1][1]]}),a.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):n===2&&a.push(...Y(t[0][0],t[0][1],t[1][0],t[1][1],s,!0,!0));return a}function ft(t,e,s,n,a,i,h,r){const l=r.roughness===0,o=[],c=[];if(l){t=t/4,c.push([e+n*Math.cos(-t),s+a*Math.sin(-t)]);for(let u=0;u<=Math.PI*2;u=u+t){const p=[e+n*Math.cos(u),s+a*Math.sin(u)];o.push(p),c.push(p)}c.push([e+n*Math.cos(0),s+a*Math.sin(0)]),c.push([e+n*Math.cos(t),s+a*Math.sin(t)])}else{const u=g(.5,r)-Math.PI/2;c.push([g(i,r)+e+.9*n*Math.cos(u-t),g(i,r)+s+.9*a*Math.sin(u-t)]);const p=Math.PI*2+u-.01;for(let f=u;f<p;f=f+t){const d=[g(i,r)+e+n*Math.cos(f),g(i,r)+s+a*Math.sin(f)];o.push(d),c.push(d)}c.push([g(i,r)+e+n*Math.cos(u+Math.PI*2+h*.5),g(i,r)+s+a*Math.sin(u+Math.PI*2+h*.5)]),c.push([g(i,r)+e+.98*n*Math.cos(u+h),g(i,r)+s+.98*a*Math.sin(u+h)]),c.push([g(i,r)+e+.9*n*Math.cos(u+h*.5),g(i,r)+s+.9*a*Math.sin(u+h*.5)])}return[c,o]}function pt(t,e,s,n,a,i,h,r,l){const o=i+g(.1,l),c=[];c.push([g(r,l)+e+.9*n*Math.cos(o-t),g(r,l)+s+.9*a*Math.sin(o-t)]);for(let u=o;u<=h;u=u+t)c.push([g(r,l)+e+n*Math.cos(u),g(r,l)+s+a*Math.sin(u)]);return c.push([e+n*Math.cos(h),s+a*Math.sin(h)]),c.push([e+n*Math.cos(h),s+a*Math.sin(h)]),W(c,null,l)}function Yt(t,e,s,n,a,i,h,r){const l=[],o=[r.maxRandomnessOffset||1,(r.maxRandomnessOffset||1)+.3];let c=[0,0];const u=r.disableMultiStroke?1:2,p=r.preserveVertices;for(let f=0;f<u;f++)f===0?l.push({op:"move",data:[h[0],h[1]]}):l.push({op:"move",data:[h[0]+(p?0:g(o[0],r)),h[1]+(p?0:g(o[0],r))]}),c=p?[a,i]:[a+g(o[f],r),i+g(o[f],r)],l.push({op:"bcurveTo",data:[t+g(o[f],r),e+g(o[f],r),s+g(o[f],r),n+g(o[f],r),c[0],c[1]]});return l}function I(t){return[...t]}function dt(t,e=0){const s=t.length;if(s<3)throw new Error("A curve must have at least three points.");const n=[];if(s===3)n.push(I(t[0]),I(t[1]),I(t[2]),I(t[2]));else{const a=[];a.push(t[0],t[0]);for(let r=1;r<t.length;r++)a.push(t[r]),r===t.length-1&&a.push(t[r]);const i=[],h=1-e;n.push(I(a[0]));for(let r=1;r+2<a.length;r++){const l=a[r];i[0]=[l[0],l[1]],i[1]=[l[0]+(h*a[r+1][0]-h*a[r-1][0])/6,l[1]+(h*a[r+1][1]-h*a[r-1][1])/6],i[2]=[a[r+1][0]+(h*a[r][0]-h*a[r+2][0])/6,a[r+1][1]+(h*a[r][1]-h*a[r+2][1])/6],i[3]=[a[r+1][0],a[r+1][1]],n.push(i[1],i[2],i[3])}}return n}function Xt(t,e){return Math.sqrt(R(t,e))}function R(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function Jt(t,e,s){const n=R(e,s);if(n===0)return R(t,e);let a=((t[0]-e[0])*(s[0]-e[0])+(t[1]-e[1])*(s[1]-e[1]))/n;return a=Math.max(0,Math.min(1,a)),R(t,L(e,s,a))}function L(t,e,s){return[t[0]+(e[0]-t[0])*s,t[1]+(e[1]-t[1])*s]}function Kt(t,e){const s=t[e+0],n=t[e+1],a=t[e+2],i=t[e+3];let h=3*n[0]-2*s[0]-i[0];h*=h;let r=3*n[1]-2*s[1]-i[1];r*=r;let l=3*a[0]-2*i[0]-s[0];l*=l;let o=3*a[1]-2*i[1]-s[1];return o*=o,h<l&&(h=l),r<o&&(r=o),h+r}function X(t,e,s,n){const a=n||[];if(Kt(t,e)<s){const i=t[e+0];a.length?Xt(a[a.length-1],i)>1&&a.push(i):a.push(i),a.push(t[e+3])}else{const h=t[e+0],r=t[e+1],l=t[e+2],o=t[e+3],c=L(h,r,.5),u=L(r,l,.5),p=L(l,o,.5),f=L(c,u,.5),d=L(u,p,.5),M=L(f,d,.5);X([h,c,f,M],0,s,a),X([M,d,p,o],0,s,a)}return a}function te(t,e){return D(t,0,t.length,e)}function D(t,e,s,n,a){const i=a||[],h=t[e],r=t[s-1];let l=0,o=1;for(let c=e+1;c<s-1;++c){const u=Jt(t[c],h,r);u>l&&(l=u,o=c)}return Math.sqrt(l)>n?(D(t,e,o+1,n,i),D(t,o,s,n,i)):(i.length||i.push(h),i.push(r)),i}function J(t,e=.15,s){const n=[],a=(t.length-1)/3;for(let i=0;i<a;i++){const h=i*3;X(t,h,e,n)}return s&&s>0?D(n,0,n.length,s):n}function ee(t,e,s){const n=tt(t),a=mt(kt(n)),i=[];let h=[],r=[0,0],l=[];const o=()=>{l.length>=4&&h.push(...J(l,e)),l=[]},c=()=>{o(),h.length&&(i.push(h),h=[])};for(const{key:p,data:f}of a)switch(p){case"M":c(),r=[f[0],f[1]],h.push(r);break;case"L":o(),h.push([f[0],f[1]]);break;case"C":if(!l.length){const d=h.length?h[h.length-1]:r;l.push([d[0],d[1]])}l.push([f[0],f[1]]),l.push([f[2],f[3]]),l.push([f[4],f[5]]);break;case"Z":o(),h.push([r[0],r[1]]);break}if(c(),!s)return i;const u=[];for(const p of i){const f=te(p,s);f.length&&u.push(f)}return u}var y="none",St=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Gt()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}line(t,e,s,n,a){const i=this._o(a);return this._d("line",[Pt(t,e,s,n,i)],i)}rectangle(t,e,s,n,a){const i=this._o(a),h=[],r=Zt(t,e,s,n,i);if(i.fill){const l=[[t,e],[t+s,e],[t+s,e+n],[t,e+n]];i.fillStyle==="solid"?h.push(N([l],i)):h.push(z([l],i))}return i.stroke!==y&&h.push(r),this._d("rectangle",h,i)}ellipse(t,e,s,n,a){const i=this._o(a),h=[],r=vt(s,n,i),l=U(t,e,i,r);if(i.fill)if(i.fillStyle==="solid"){const o=U(t,e,i,r).opset;o.type="fillPath",h.push(o)}else h.push(z([l.estimatedPoints],i));return i.stroke!==y&&h.push(l.opset),this._d("ellipse",h,i)}circle(t,e,s,n){const a=this.ellipse(t,e,s,s,n);return a.shape="circle",a}linearPath(t,e){const s=this._o(e);return this._d("linearPath",[G(t,!1,s)],s)}arc(t,e,s,n,a,i,h=!1,r){const l=this._o(r),o=[],c=ct(t,e,s,n,a,i,h,!0,l);if(h&&l.fill)if(l.fillStyle==="solid"){const u=Object.assign({},l);u.disableMultiStroke=!0;const p=ct(t,e,s,n,a,i,!0,!1,u);p.type="fillPath",o.push(p)}else o.push(Nt(t,e,s,n,a,i,l));return l.stroke!==y&&o.push(c),this._d("arc",o,l)}curve(t,e){const s=this._o(e),n=[],a=ot(t,s);if(s.fill&&s.fill!==y)if(s.fillStyle==="solid"){const i=ot(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(i.ops)})}else{const i=[],h=t;if(h.length){const l=typeof h[0][0]=="number"?[h]:h;for(const o of l)o.length<3?i.push(...o):o.length===3?i.push(...J(dt([o[0],o[0],o[1],o[2]]),10,(1+s.roughness)/2)):i.push(...J(dt(o),10,(1+s.roughness)/2))}i.length&&n.push(z([i],s))}return s.stroke!==y&&n.push(a),this._d("curve",n,s)}polygon(t,e){const s=this._o(e),n=[],a=G(t,!0,s);return s.fill&&(s.fillStyle==="solid"?n.push(N([t],s)):n.push(z([t],s))),s.stroke!==y&&n.push(a),this._d("polygon",n,s)}path(t,e){const s=this._o(e),n=[];if(!t)return this._d("path",n,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const a=s.fill&&s.fill!=="transparent"&&s.fill!==y,i=s.stroke!==y,h=!!(s.simplification&&s.simplification<1),r=h?4-4*(s.simplification||1):(1+s.roughness)/2,l=ee(t,1,r),o=lt(t,s);if(a)if(s.fillStyle==="solid")if(l.length===1){const c=lt(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(c.ops)})}else n.push(N(l,s));else n.push(z(l,s));return i&&(h?l.forEach(c=>{n.push(G(c,!1,s))}):n.push(o)),this._d("path",n,s)}opsToPath(t,e){let s="";for(const n of t.ops){const a=typeof e=="number"&&e>=0?n.data.map(i=>+i.toFixed(e)):n.data;switch(n.op){case"move":s+=`M${a[0]} ${a[1]} `;break;case"bcurveTo":s+=`C${a[0]} ${a[1]}, ${a[2]} ${a[3]}, ${a[4]} ${a[5]} `;break;case"lineTo":s+=`L${a[0]} ${a[1]} `;break}}return s.trim()}toPaths(t){const e=t.sets||[],s=t.options||this.defaultOptions,n=[];for(const a of e){let i=null;switch(a.type){case"path":i={d:this.opsToPath(a),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:y};break;case"fillPath":i={d:this.opsToPath(a),stroke:y,strokeWidth:0,fill:s.fill||y};break;case"fillSketch":i=this.fillSketch(a,s);break}i&&n.push(i)}return n}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||y,strokeWidth:s,fill:y}}_mergedShape(t){return t.filter((e,s)=>s===0?!0:e.op!=="move")}},se={...new St().defaultOptions,disableMultiStroke:!0},ne={linecap:"round",zIndexOffset:0,color:"currentColor",strokeWidth:2,iterations:1,brackets:5,opacity:1,class:""},ae=class{path;length;trace;startTime=-1;duration=0;process="freeze";painted=this.listen;erased=this.listen;constructor(t,e=-1,s=!1){this.path=t,this.length=t.getTotalLength(),this.trace=this.clacInitTrace(e),this.path.style.strokeDasharray=`${this.length}px`,this.path.style.strokeDashoffset=`${this.length-this.trace}px`,s&&this.start()}done(){return this.process==="paint"&&this.trace>=this.length||this.process==="erase"&&this.trace<=0}clacInitTrace(t){return t===-1?this.length:t}update(){this.trace=Math.min(this.trace,this.length),this.trace=Math.max(this.trace,0);const t=this.length-this.trace;this.path.style.strokeDashoffset=`${t}px`}initStartTime(t){this.startTime===-1&&(this.startTime=t)}calcStep(t,e){if(this.duration===0)return this.length;const s=(t-e)/this.duration;return s>=1?this.length:this.length*s}_paint(t,e){this.initStartTime(t);const s=this.calcStep(t,e??this.startTime);this.trace+=s,this.update(),this.done()&&this.painted(),this._listen(t)}_erase(t,e){this.initStartTime(t);const s=this.calcStep(t,e??this.startTime);this.trace-=s,this.update(),this.done()&&this.erased(),this._listen(t)}_listen(t){requestAnimationFrame(e=>{switch(this.process){case"paint":this._paint(e,t);break;case"erase":this._erase(e,t);break;case"listen":this._listen(e);break}})}paint(t,e=this.trace){this.duration=t,this.process="paint",this.startTime=-1,this.trace=this.clacInitTrace(e)}erase(t,e=this.trace){this.duration=t,this.process="erase",this.startTime=-1,this.trace=this.clacInitTrace(e)}stop(){this.process="freeze",this.startTime=-1}listen(){this.process="listen",this.startTime=-1}start(){this.process==="freeze"&&(this.process="listen",this._listen())}onPainted(t){this.painted=()=>{this.listen(),t()}}onErased(t){this.erased=()=>{this.listen(),t()}}};function S(t){return ie(t.sets)}function ie(t){const e=[];for(const s of t){let n="";for(const a of s.ops){const i=a.data;switch(a.op){case"move":n.trim()&&e.push(n.trim()),n=`M${i[0]} ${i[1]} `;break;case"bcurveTo":n+=`C${i[0]} ${i[1]}, ${i[2]} ${i[3]}, ${i[4]} ${i[5]} `;break;case"lineTo":n+=`L${i[0]} ${i[1]} `;break}}n.trim()&&e.push(n.trim())}return e}var gt="http://www.w3.org/2000/svg",re=class{options;target;svg;paths;animators;pathDatas;pathLengths=[];pathsTotalLength=0;cur;rect;duration;createSVG(){const t=document.createElementNS(gt,"svg");t.setAttribute("viewBox",`0 0 ${this.rect.width} ${this.rect.height}`),this.options.class.length&&t.setAttribute("class",this.options.class);const e=t.style;return e.zIndex=this.target.style.zIndex+this.options.zIndexOffset,e.overflow="visible",e.pointerEvents="none",e.position="absolute",e.top="0",e.left="0",t}createPath(t,e,s,n,a){const i=document.createElementNS(gt,"path");return i.setAttribute("d",t),i.setAttribute("stroke",e),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap",s),i.setAttribute("stroke-width",n.toString()),i.setAttribute("stroke-opacity",a.toString()),i}constructor(t,e,s){switch(this.options={...ne,...s},this.target=t,this.rect=t.getBoundingClientRect(),typeof e=="function"&&(e=e(this.rect.width,this.rect.height)),typeof e){case"string":this.pathDatas=[e];break;case"object":Array.isArray(e)?this.pathDatas=e.map(n=>typeof n=="string"?[n]:S(n)).flat():this.pathDatas=S(e);break}this.cur=0,this.duration=1e3,this.svg=this.createSVG(),this.initTarget(),this.paths=this.cratePaths(),this.animators=this.createAnimators(),this.animators[this.cur].start()}initTarget(){return this.target.style.setProperty("position","relative"),this.target.appendChild(this.svg),this.target}cratePaths(){const t=[];for(const e of this.pathDatas){const s=this.createPath(e,this.options.color,this.options.linecap,this.options.strokeWidth,this.options.opacity);t.push(s);const n=s.getTotalLength();this.pathLengths.push(n),this.pathsTotalLength+=n,this.svg.appendChild(s)}return t}durationOf(t){return this.duration*this.pathLengths[t]/this.pathsTotalLength}createAnimators(){const t=this.paths.map(e=>new ae(e,0));for(let e=0;e<t.length;++e)e!==t.length-1&&t[e].onPainted(()=>{t[e].stop(),this.cur=e+1,t[this.cur].start(),t[this.cur].paint(this.durationOf(this.cur))}),e!==0&&t[e].onErased(()=>{t[e].stop(),this.cur=e-1,t[this.cur].start(),t[this.cur].erase(this.durationOf(this.cur))});return t}show(t=1e3){this.duration=t,this.animators[this.cur].paint(this.durationOf(this.cur))}stop(){this.animators[this.cur].listen()}hide(t=1e3){this.duration=t,this.animators[this.cur].erase(this.durationOf(this.cur))}remove(){this.animators.forEach(t=>t.stop()),this.target.removeChild(this.svg)}onShowed(t){this.animators[this.animators.length-1].onPainted(t)}onHidden(t){this.animators[0].onErased(t)}},he=class extends St{constructor(t={}){super({options:{...se,...t}})}bracket(t,e,s,n,a,i=5){switch(a){case 8:return this.linearPath([[t,e+i],[t,e],[t+s,e],[t+s,e+i]]);case 4:return this.linearPath([[t+i,e],[t,e],[t,e+n],[t+i,e+n]]);case 2:return this.linearPath([[t,e+n-i],[t,e+n],[t+s,e+n],[t+s,e+n-i]]);case 1:return this.linearPath([[t+s-i,e],[t+s,e],[t+s,e+n],[t+s-i,e+n]])}}d(t,e=5){switch(t){case"-":case"=":return(s,n)=>[S(this.line(0,n/2,s,n/2)),S(this.line(s,n/2,0,n/2))].flat();case"_":return(s,n)=>[S(this.line(0,n,s,n)),S(this.line(s,n,0,n))].flat();case"o":return(s,n)=>[S(this.ellipse(s/2,n/2,s,n)),S(this.ellipse(s/2,n/2,s,n))].flat();case"box":return(s,n)=>[S(this.rectangle(0,0,s,n)),S(this.rectangle(0,0,s,n))].flat();case"[]":return(s,n)=>Array.from({length:4},(a,i)=>{if(e&1<<3-i)return S(this.bracket(0,0,s,n,1<<3-i))}).filter(a=>!!a).flat();case"x":return(s,n)=>[S(this.linearPath([[0,0],[s,n]])),S(this.linearPath([[s,0],[0,n]]))].flat()}}};function oe(t,e,s){const n=s||{};e==="="&&(n.linecap="butt",n.strokeWidth=t.getBoundingClientRect().height);const a=new he(s?.rough);return new re(t,a.d(e,s?.brackets),s)}export{oe as notate};
