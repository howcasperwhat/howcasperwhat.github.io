import{r as p,E as j,d as y,e as i,c as o,u,F as h,t as x,x as A,s as D,G as N,A as M,o as T,H as z,I,j as g,v as k,q as _,J as v,D as V}from"./app-mj1sI6JI.js";const b=p(!1),F=j(b),L=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];class R{constructor(e,a){this.width=e,this.height=a,this.width=Number.parseInt(e.toString()),this.height=Number.parseInt(a.toString()),this.reset()}state=p();get board(){return this.state.value.board}reset(){this.state.value={gameState:"playing",mineGenerated:!1,board:Array.from({length:this.height},(e,a)=>Array.from({length:this.width},(t,n)=>({x:n,y:a,revealed:!1,flagged:!1,mine:!1,adjacentMines:0})))}}showAllMines(){this.board.flat().forEach(e=>{e.mine&&(e.revealed=!0)})}generateMines(e,a){for(const t of e)for(const n of t)Math.abs(n.x-a.x)<=1||Math.abs(n.y-a.y)<=1||(n.mine=Math.random()<.2);this.updateNumbers(e)}updateNumbers(e){e.forEach(a=>{a.forEach(t=>{t.mine||this.getSiblings(t).forEach(n=>{n.mine&&++t.adjacentMines})})})}flag(e){this.state.value.gameState==="playing"&&this.state.value.mineGenerated&&(e.revealed||(e.flagged=!e.flagged))}reveal(e){if(this.state.value.gameState==="playing"){if(this.state.value.mineGenerated||(this.generateMines(this.board,e),this.state.value.mineGenerated=!0),e.flagged){e.flagged=!1;return}if(e.revealed=!0,e.mine){this.state.value.gameState="lose",this.showAllMines();return}this.expendBlock(e),this.checkGameState(this.board)}}expendBlock(e){this.state.value.gameState==="playing"&&(e.adjacentMines||this.getSiblings(e).forEach(a=>{a.revealed||(a.revealed=!0,this.expendBlock(a))}))}getSiblings(e){return L.map(([a,t])=>{const[n,r]=[e.x+a,e.y+t];if(n>=0&&n<this.width&&r>=0&&r<this.height)return this.board[r][n]}).filter(Boolean)}checkGameState(e){if(!this.state.value.mineGenerated)return;e.flat().every(t=>t.revealed||t.mine)&&(this.showAllMines(),this.state.value.gameState="won")}}const Y={key:0,"i-mdi-flag":""},q={key:0,"font-bold":""},H={key:1,"i-mdi-mine":"","c-black":"","dark:c-white":""},J=y({__name:"MineBlock",props:{block:{}},setup(f){const e=["text-transparent","text-blue","text-green","text-red","text-purple","text-yellow","text-pink","text-cyan","text-gray"];function a(t){let[n,r]=["",""];return t.flagged?(r="bg-gray-300 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600",n="text-red"):t.revealed?(r=t.mine?"bg-red-300 dark:bg-red/60":"bg-gray-300 hover:gray-300 dark:bg-gray-600 dark:hover:bg-gray-600",n=e[t.adjacentMines]):(r="bg-gray-400 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700",n="text-transparent"),`${r} ${n}`}return(t,n)=>(i(),o("button",{class:D(a(t.block)),"w-10":"","m-.5":"","h-10":"","flex-center":""},[t.block.flagged?(i(),o("div",Y)):t.block.revealed||u(b)?(i(),o(h,{key:1},[t.block.mine?(i(),o("div",H)):(i(),o("div",q,x(t.block.adjacentMines),1))],64)):A("",!0)],2))}}),O={grid:"~ flow-col gap-6","justify-center":"","m-y-2":""},P=y({__name:"MineSweeper",setup(f){const e=V(),a=N(),t=Math.min(Math.floor(a.width.value/52),16),n=Math.min(Math.floor(a.height.value/64),16),r=new R(t,n),S=M(()=>r.board),C=M(()=>r.state.value.gameState),w=p(0);function E(){w.value=Date.now()}function $(l){Date.now()-w.value>150?r.flag(l):r.reveal(l)}return T(()=>{z("minesweeper",r.state),I(C,(l,s)=>{s==="playing"&&(l==="won"?e.success("You won!"):l==="lose"&&e.error("You lose!"))})}),(l,s)=>(i(),o(h,null,[g("div",{onContextmenu:s[1]||(s[1]=v(()=>{},["prevent"]))},[(i(!0),o(h,null,k(S.value,(c,B)=>(i(),o("div",{key:B,"flex-center":"","select-none":""},[(i(!0),o(h,null,k(c,(d,G)=>(i(),_(J,{key:G,block:d,onTouchstart:s[0]||(s[0]=v(m=>E(),["prevent"])),onTouchend:v(m=>$(d),["prevent"]),onClick:m=>u(r).reveal(d),onContextmenu:m=>u(r).flag(d)},null,8,["block","onTouchend","onClick","onContextmenu"]))),128))]))),128))],32),g("div",O,[g("button",{btn:"","bg-blue":"","c-black":"",onClick:s[2]||(s[2]=c=>u(F)())},x(u(b)?"DEV":"NORMAL"),1),g("button",{btn:"","bg-amber":"","c-black":"",onClick:s[3]||(s[3]=c=>u(r).reset())}," RESET ")])],64))}}),K=y({__name:"MineSweeper",setup(f){return(e,a)=>(i(),_(P))}});export{K as default};
