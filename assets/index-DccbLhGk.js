import{R as o}from"./generator-wcUYG9Ml.js";var c=class{constructor(t,s=-1,e=!1){this.startTime=-1,this.duration=0,this.process="freeze",this.painted=this.listen,this.erased=this.listen,this.path=t,this.length=t.getTotalLength(),this.trace=this.clacInitTrace(s),this.path.style.strokeDasharray=`${this.length}px`,this.path.style.strokeDashoffset=`${this.length-this.trace}px`,e&&this.start()}done(){return this.process==="paint"&&this.trace>=this.length||this.process==="erase"&&this.trace<=0}clacInitTrace(t){return t===-1?this.length:t}update(){this.trace=Math.min(this.trace,this.length),this.trace=Math.max(this.trace,0);let t=this.length-this.trace;this.path.style.strokeDashoffset=`${t}px`}initStartTime(t){this.startTime===-1&&(this.startTime=t)}calcStep(t,s){if(this.duration===0)return this.length;const e=(t-s)/this.duration;return e>=1?this.length:this.length*e}_paint(t,s){this.initStartTime(t);const e=this.calcStep(t,s??this.startTime);this.trace+=e,this.update(),this.done()&&this.painted(),this._listen(t)}_erase(t,s){this.initStartTime(t);const e=this.calcStep(t,s??this.startTime);this.trace-=e,this.update(),this.done()&&this.erased(),this._listen(t)}_listen(t){requestAnimationFrame(s=>{switch(this.process){case"paint":this._paint(s,t);break;case"erase":this._erase(s,t);break;case"listen":this._listen(s);break}})}paint(t,s=this.trace){this.duration=t,this.process="paint",this.startTime=-1,this.trace=this.clacInitTrace(s)}erase(t,s=this.trace){this.duration=t,this.process="erase",this.startTime=-1,this.trace=this.clacInitTrace(s)}stop(){this.process="freeze",this.startTime=-1}listen(){this.process="listen",this.startTime=-1}start(){this.process==="freeze"&&(this.process="listen",this._listen())}onPainted(t){this.painted=()=>{this.listen(),t()}}onErased(t){this.erased=()=>{this.listen(),t()}}},l={...new o().defaultOptions,disableMultiStroke:!0},u={linecap:"round",zIndexOffset:0,color:"currentColor",strokeWidth:2,iterations:1,brackets:5,opacity:1,class:""};function r(t){return p(t.sets)}function p(t){const s=[];for(const e of t){let i="";for(const h of e.ops){const a=h.data;switch(h.op){case"move":i.trim()&&s.push(i.trim()),i=`M${a[0]} ${a[1]} `;break;case"bcurveTo":i+=`C${a[0]} ${a[1]}, ${a[2]} ${a[3]}, ${a[4]} ${a[5]} `;break;case"lineTo":i+=`L${a[0]} ${a[1]} `;break}}i.trim()&&s.push(i.trim())}return s}var n="http://www.w3.org/2000/svg",d=class{constructor(t,s,e){switch(this.pathLengths=[],this.pathsTotalLength=0,this.options={...u,...e},this.target=t,this.rect=t.getBoundingClientRect(),typeof s=="function"&&(s=s(this.rect.width,this.rect.height)),typeof s){case"string":this.pathDatas=[s];break;case"object":Array.isArray(s)?this.pathDatas=s.map(i=>typeof i=="string"?[i]:r(i)).flat():this.pathDatas=r(s);break}this.cur=0,this.duration=1e3,this.svg=this.createSVG(),this.initTarget(),this.paths=this.cratePaths(),this.animators=this.createAnimators(),this.animators[this.cur].start()}createSVG(){const t=document.createElementNS(n,"svg");t.setAttribute("viewBox",`0 0 ${this.rect.width} ${this.rect.height}`),this.options.class.length&&t.setAttribute("class",this.options.class);const s=t.style;return s.zIndex=this.target.style.zIndex+this.options.zIndexOffset,s.overflow="visible",s.pointerEvents="none",s.position="absolute",s.top="0",s.left="0",t}createPath(t,s,e,i,h){const a=document.createElementNS(n,"path");return a.setAttribute("d",t),a.setAttribute("stroke",s),a.setAttribute("fill","none"),a.setAttribute("stroke-linecap",e),a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke-opacity",h.toString()),a}initTarget(){return this.target.style.setProperty("position","relative"),this.target.appendChild(this.svg),this.target}cratePaths(){const t=[];for(const s of this.pathDatas){const e=this.createPath(s,this.options.color,this.options.linecap,this.options.strokeWidth,this.options.opacity);t.push(e);const i=e.getTotalLength();this.pathLengths.push(i),this.pathsTotalLength+=i,this.svg.appendChild(e)}return t}durationOf(t){return this.duration*this.pathLengths[t]/this.pathsTotalLength}createAnimators(){const t=this.paths.map(s=>new c(s,0));for(let s=0;s<t.length;++s)s!==t.length-1&&t[s].onPainted(()=>{t[s].stop(),this.cur=s+1,t[this.cur].start(),t[this.cur].paint(this.durationOf(this.cur))}),s!==0&&t[s].onErased(()=>{t[s].stop(),this.cur=s-1,t[this.cur].start(),t[this.cur].erase(this.durationOf(this.cur))});return t}show(t=1e3){this.duration=t,this.animators[this.cur].paint(this.durationOf(this.cur))}stop(){this.animators[this.cur].listen()}hide(t=1e3){this.duration=t,this.animators[this.cur].erase(this.durationOf(this.cur))}remove(){this.animators.forEach(t=>t.stop()),this.target.removeChild(this.svg)}onShowed(t){this.animators[this.animators.length-1].onPainted(t)}onHidden(t){this.animators[0].onErased(t)}},f=class extends o{constructor(t={}){super({options:{...l,...t}})}bracket(t,s,e,i,h,a=5){switch(h){case 8:return this.linearPath([[t,s+a],[t,s],[t+e,s],[t+e,s+a]]);case 4:return this.linearPath([[t+a,s],[t,s],[t,s+i],[t+a,s+i]]);case 2:return this.linearPath([[t,s+i-a],[t,s+i],[t+e,s+i],[t+e,s+i-a]]);case 1:return this.linearPath([[t+e-a,s],[t+e,s],[t+e,s+i],[t+e-a,s+i]])}}d(t,s=5){switch(t){case"-":case"=":return(e,i)=>[r(this.line(0,i/2,e,i/2)),r(this.line(e,i/2,0,i/2))].flat();case"_":return(e,i)=>[r(this.line(0,i,e,i)),r(this.line(e,i,0,i))].flat();case"o":return(e,i)=>[r(this.ellipse(e/2,i/2,e,i)),r(this.ellipse(e/2,i/2,e,i))].flat();case"box":return(e,i)=>[r(this.rectangle(0,0,e,i)),r(this.rectangle(0,0,e,i))].flat();case"[]":return(e,i)=>Array.from({length:4},(h,a)=>{if(s&1<<3-a)return r(this.bracket(0,0,e,i,1<<3-a))}).filter(h=>!!h).flat();case"x":return(e,i)=>[r(this.linearPath([[0,0],[e,i]])),r(this.linearPath([[e,0],[0,i]]))].flat()}}},m=(t,s,e)=>{const i=e||{};s==="="&&(i.linecap="butt",i.strokeWidth=t.getBoundingClientRect().height);const h=new f(e?.rough);return new d(t,h.d(s,e?.brackets),e)};export{m as notate};
