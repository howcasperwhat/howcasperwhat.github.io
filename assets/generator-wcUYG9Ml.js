function D(a,t,e){if(a&&a.length){const[s,n]=t,c=Math.PI/180*e,r=Math.cos(c),o=Math.sin(c);for(const l of a){const[i,h]=l;l[0]=(i-s)*r-(h-n)*o+s,l[1]=(i-s)*o+(h-n)*r+n}}}function vt(a,t,e){const s=[];a.forEach(n=>s.push(...n)),D(s,t,e)}function Lt(a,t){return a[0]===t[0]&&a[1]===t[1]}function wt(a,t,e,s=1){const n=e,c=Math.max(t,.1),r=a[0]&&a[0][0]&&typeof a[0][0]=="number"?[a]:a,o=[0,0];if(n)for(const i of r)D(i,o,n);const l=_t(r,c,s);if(n){for(const i of r)D(i,o,-n);vt(l,o,-n)}return l}function _t(a,t,e){const s=[];for(const i of a){const h=[...i];Lt(h[0],h[h.length-1])||h.push([h[0][0],h[0][1]]),h.length>2&&s.push(h)}const n=[];t=Math.max(t,.1);const c=[];for(const i of s)for(let h=0;h<i.length-1;h++){const u=i[h],f=i[h+1];if(u[1]!==f[1]){const p=Math.min(u[1],f[1]);c.push({ymin:p,ymax:Math.max(u[1],f[1]),x:p===u[1]?u[0]:f[0],islope:(f[0]-u[0])/(f[1]-u[1])})}}if(c.sort((i,h)=>i.ymin<h.ymin?-1:i.ymin>h.ymin?1:i.x<h.x?-1:i.x>h.x?1:i.ymax===h.ymax?0:(i.ymax-h.ymax)/Math.abs(i.ymax-h.ymax)),!c.length)return n;let r=[],o=c[0].ymin,l=0;for(;r.length||c.length;){if(c.length){let i=-1;for(let u=0;u<c.length&&!(c[u].ymin>o);u++)i=u;c.splice(0,i+1).forEach(u=>{r.push({s:o,edge:u})})}if(r=r.filter(i=>!(i.edge.ymax<=o)),r.sort((i,h)=>i.edge.x===h.edge.x?0:(i.edge.x-h.edge.x)/Math.abs(i.edge.x-h.edge.x)),(e!==1||l%t===0)&&r.length>1)for(let i=0;i<r.length;i=i+2){const h=i+1;if(h>=r.length)break;const u=r[i].edge,f=r[h].edge;n.push([[Math.round(u.x),o],[Math.round(f.x),o]])}o+=e,r.forEach(i=>{i.edge.x=i.edge.x+e*i.edge.islope}),l++}return n}function A(a,t){var e;const s=t.hachureAngle+90;let n=t.hachureGap;n<0&&(n=t.strokeWidth*4),n=Math.round(Math.max(n,.1));let c=1;return t.roughness>=1&&(((e=t.randomizer)===null||e===void 0?void 0:e.next())||Math.random())>.7&&(c=n),wt(a,n,s,c||1)}class J{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const s=A(t,e);return{type:"fillSketch",ops:this.renderLines(s,e)}}renderLines(t,e){const s=[];for(const n of t)s.push(...this.helper.doubleLineOps(n[0][0],n[0][1],n[1][0],n[1][1],e));return s}}function V(a){const t=a[0],e=a[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}class xt extends J{fillPolygons(t,e){let s=e.hachureGap;s<0&&(s=e.strokeWidth*4),s=Math.max(s,.1);const n=Object.assign({},e,{hachureGap:s}),c=A(t,n),r=Math.PI/180*e.hachureAngle,o=[],l=s*.5*Math.cos(r),i=s*.5*Math.sin(r);for(const[u,f]of c)V([u,f])&&o.push([[u[0]-l,u[1]+i],[...f]],[[u[0]+l,u[1]-i],[...f]]);return{type:"fillSketch",ops:this.renderLines(o,e)}}}class zt extends J{fillPolygons(t,e){const s=this._fillPolygons(t,e),n=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),c=this._fillPolygons(t,n);return s.ops=s.ops.concat(c.ops),s}}class Ct{constructor(t){this.helper=t}fillPolygons(t,e){e=Object.assign({},e,{hachureAngle:0});const s=A(t,e);return this.dotsOnLines(s,e)}dotsOnLines(t,e){const s=[];let n=e.hachureGap;n<0&&(n=e.strokeWidth*4),n=Math.max(n,.1);let c=e.fillWeight;c<0&&(c=e.strokeWidth/2);const r=n/4;for(const o of t){const l=V(o),i=l/n,h=Math.ceil(i)-1,u=l-h*n,f=(o[0][0]+o[1][0])/2-n/4,p=Math.min(o[0][1],o[1][1]);for(let d=0;d<h;d++){const M=p+u+d*n,k=f-r+Math.random()*2*r,m=M-r+Math.random()*2*r,b=this.helper.ellipse(k,m,c,c,e);s.push(...b.ops)}}return{type:"fillSketch",ops:s}}}class Tt{constructor(t){this.helper=t}fillPolygons(t,e){const s=A(t,e);return{type:"fillSketch",ops:this.dashedLine(s,e)}}dashedLine(t,e){const s=e.dashOffset<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashOffset,n=e.dashGap<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashGap,c=[];return t.forEach(r=>{const o=V(r),l=Math.floor(o/(s+n)),i=(o+n-l*(s+n))/2;let h=r[0],u=r[1];h[0]>u[0]&&(h=r[1],u=r[0]);const f=Math.atan((u[1]-h[1])/(u[0]-h[0]));for(let p=0;p<l;p++){const d=p*(s+n),M=d+s,k=[h[0]+d*Math.cos(f)+i*Math.cos(f),h[1]+d*Math.sin(f)+i*Math.sin(f)],m=[h[0]+M*Math.cos(f)+i*Math.cos(f),h[1]+M*Math.sin(f)+i*Math.sin(f)];c.push(...this.helper.doubleLineOps(k[0],k[1],m[0],m[1],e))}}),c}}class At{constructor(t){this.helper=t}fillPolygons(t,e){const s=e.hachureGap<0?e.strokeWidth*4:e.hachureGap,n=e.zigzagOffset<0?s:e.zigzagOffset;e=Object.assign({},e,{hachureGap:s+n});const c=A(t,e);return{type:"fillSketch",ops:this.zigzagLines(c,n,e)}}zigzagLines(t,e,s){const n=[];return t.forEach(c=>{const r=V(c),o=Math.round(r/(2*e));let l=c[0],i=c[1];l[0]>i[0]&&(l=c[1],i=c[0]);const h=Math.atan((i[1]-l[1])/(i[0]-l[0]));for(let u=0;u<o;u++){const f=u*2*e,p=(u+1)*2*e,d=Math.sqrt(2*Math.pow(e,2)),M=[l[0]+f*Math.cos(h),l[1]+f*Math.sin(h)],k=[l[0]+p*Math.cos(h),l[1]+p*Math.sin(h)],m=[M[0]+d*Math.cos(h+Math.PI/4),M[1]+d*Math.sin(h+Math.PI/4)];n.push(...this.helper.doubleLineOps(M[0],M[1],m[0],m[1],s),...this.helper.doubleLineOps(m[0],m[1],k[0],k[1],s))}}),n}}const P={};function qt(a,t){let e=a.fillStyle||"hachure";if(!P[e])switch(e){case"zigzag":P[e]||(P[e]=new xt(t));break;case"cross-hatch":P[e]||(P[e]=new zt(t));break;case"dots":P[e]||(P[e]=new Ct(t));break;case"dashed":P[e]||(P[e]=new Tt(t));break;case"zigzag-line":P[e]||(P[e]=new At(t));break;case"hachure":default:e="hachure",P[e]||(P[e]=new J(t));break}return P[e]}function Et(){return Math.floor(Math.random()*2**31)}class Ft{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const It=0,Q=1,dt=2,E={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Rt(a){const t=new Array;for(;a!=="";)if(a.match(/^([ \t\r\n,]+)/))a=a.substr(RegExp.$1.length);else if(a.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:It,text:RegExp.$1},a=a.substr(RegExp.$1.length);else if(a.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:Q,text:`${parseFloat(RegExp.$1)}`},a=a.substr(RegExp.$1.length);else return[];return t[t.length]={type:dt,text:""},t}function H(a,t){return a.type===t}function K(a){const t=[],e=Rt(a);let s="BOD",n=0,c=e[n];for(;!H(c,dt);){let r=0;const o=[];if(s==="BOD")if(c.text==="M"||c.text==="m")n++,r=E[c.text],s=c.text;else return K("M0,0"+a);else H(c,Q)?r=E[s]:(n++,r=E[c.text],s=c.text);if(n+r<e.length){for(let l=n;l<n+r;l++){const i=e[l];if(H(i,Q))o[o.length]=+i.text;else throw new Error("Param not a number: "+s+","+i.text)}if(typeof E[s]=="number"){const l={key:s,data:o};t.push(l),n+=r,c=e[n],s==="M"&&(s="L"),s==="m"&&(s="l")}else throw new Error("Bad segment: "+s)}else throw new Error("Path data ended short")}return t}function gt(a){let t=0,e=0,s=0,n=0;const c=[];for(const{key:r,data:o}of a)switch(r){case"M":c.push({key:"M",data:[...o]}),[t,e]=o,[s,n]=o;break;case"m":t+=o[0],e+=o[1],c.push({key:"M",data:[t,e]}),s=t,n=e;break;case"L":c.push({key:"L",data:[...o]}),[t,e]=o;break;case"l":t+=o[0],e+=o[1],c.push({key:"L",data:[t,e]});break;case"C":c.push({key:"C",data:[...o]}),t=o[4],e=o[5];break;case"c":{const l=o.map((i,h)=>h%2?i+e:i+t);c.push({key:"C",data:l}),t=l[4],e=l[5];break}case"Q":c.push({key:"Q",data:[...o]}),t=o[2],e=o[3];break;case"q":{const l=o.map((i,h)=>h%2?i+e:i+t);c.push({key:"Q",data:l}),t=l[2],e=l[3];break}case"A":c.push({key:"A",data:[...o]}),t=o[5],e=o[6];break;case"a":t+=o[5],e+=o[6],c.push({key:"A",data:[o[0],o[1],o[2],o[3],o[4],t,e]});break;case"H":c.push({key:"H",data:[...o]}),t=o[0];break;case"h":t+=o[0],c.push({key:"H",data:[t]});break;case"V":c.push({key:"V",data:[...o]}),e=o[0];break;case"v":e+=o[0],c.push({key:"V",data:[e]});break;case"S":c.push({key:"S",data:[...o]}),t=o[2],e=o[3];break;case"s":{const l=o.map((i,h)=>h%2?i+e:i+t);c.push({key:"S",data:l}),t=l[2],e=l[3];break}case"T":c.push({key:"T",data:[...o]}),t=o[0],e=o[1];break;case"t":t+=o[0],e+=o[1],c.push({key:"T",data:[t,e]});break;case"Z":case"z":c.push({key:"Z",data:[]}),t=s,e=n;break}return c}function Mt(a){const t=[];let e="",s=0,n=0,c=0,r=0,o=0,l=0;for(const{key:i,data:h}of a){switch(i){case"M":t.push({key:"M",data:[...h]}),[s,n]=h,[c,r]=h;break;case"C":t.push({key:"C",data:[...h]}),s=h[4],n=h[5],o=h[2],l=h[3];break;case"L":t.push({key:"L",data:[...h]}),[s,n]=h;break;case"H":s=h[0],t.push({key:"L",data:[s,n]});break;case"V":n=h[0],t.push({key:"L",data:[s,n]});break;case"S":{let u=0,f=0;e==="C"||e==="S"?(u=s+(s-o),f=n+(n-l)):(u=s,f=n),t.push({key:"C",data:[u,f,...h]}),o=h[0],l=h[1],s=h[2],n=h[3];break}case"T":{const[u,f]=h;let p=0,d=0;e==="Q"||e==="T"?(p=s+(s-o),d=n+(n-l)):(p=s,d=n);const M=s+2*(p-s)/3,k=n+2*(d-n)/3,m=u+2*(p-u)/3,b=f+2*(d-f)/3;t.push({key:"C",data:[M,k,m,b,u,f]}),o=p,l=d,s=u,n=f;break}case"Q":{const[u,f,p,d]=h,M=s+2*(u-s)/3,k=n+2*(f-n)/3,m=p+2*(u-p)/3,b=d+2*(f-d)/3;t.push({key:"C",data:[M,k,m,b,p,d]}),o=u,l=f,s=p,n=d;break}case"A":{const u=Math.abs(h[0]),f=Math.abs(h[1]),p=h[2],d=h[3],M=h[4],k=h[5],m=h[6];u===0||f===0?(t.push({key:"C",data:[s,n,k,m,k,m]}),s=k,n=m):(s!==k||n!==m)&&(kt(s,n,k,m,u,f,p,d,M).forEach(function(Z){t.push({key:"C",data:Z})}),s=k,n=m);break}case"Z":t.push({key:"Z",data:[]}),s=c,n=r;break}e=i}return t}function Gt(a){return Math.PI*a/180}function C(a,t,e){const s=a*Math.cos(e)-t*Math.sin(e),n=a*Math.sin(e)+t*Math.cos(e);return[s,n]}function kt(a,t,e,s,n,c,r,o,l,i){const h=Gt(r);let u=[],f=0,p=0,d=0,M=0;if(i)[f,p,d,M]=i;else{[a,t]=C(a,t,-h),[e,s]=C(e,s,-h);const O=(a-e)/2,y=(t-s)/2;let v=O*O/(n*n)+y*y/(c*c);v>1&&(v=Math.sqrt(v),n=v*n,c=v*c);const q=o===l?-1:1,x=n*n,j=c*c,St=x*j-x*y*y-j*O*O,Ot=x*y*y+j*O*O,ct=q*Math.sqrt(Math.abs(St/Ot));d=ct*n*y/c+(a+e)/2,M=ct*-c*O/n+(t+s)/2,f=Math.asin(parseFloat(((t-M)/c).toFixed(9))),p=Math.asin(parseFloat(((s-M)/c).toFixed(9))),a<d&&(f=Math.PI-f),e<d&&(p=Math.PI-p),f<0&&(f=Math.PI*2+f),p<0&&(p=Math.PI*2+p),l&&f>p&&(f=f-Math.PI*2),!l&&p>f&&(p=p-Math.PI*2)}let k=p-f;if(Math.abs(k)>Math.PI*120/180){const O=p,y=e,v=s;l&&p>f?p=f+Math.PI*120/180*1:p=f+Math.PI*120/180*-1,e=d+n*Math.cos(p),s=M+c*Math.sin(p),u=kt(e,s,y,v,n,c,r,0,l,[p,O,d,M])}k=p-f;const m=Math.cos(f),b=Math.sin(f),Z=Math.cos(p),Pt=Math.sin(p),tt=Math.tan(k/4),et=4/3*n*tt,st=4/3*c*tt,nt=[a,t],_=[a+et*b,t-st*m],at=[e+et*Pt,s-st*Z],ot=[e,s];if(_[0]=2*nt[0]-_[0],_[1]=2*nt[1]-_[1],i)return[_,at,ot].concat(u);{u=[_,at,ot].concat(u);const O=[];for(let y=0;y<u.length;y+=3){const v=C(u[y][0],u[y][1],h),q=C(u[y+1][0],u[y+1][1],h),x=C(u[y+2][0],u[y+2][1],h);O.push([v[0],v[1],q[0],q[1],x[0],x[1]])}return O}}const Wt={randOffset:Ht,randOffsetWithRange:Bt,ellipse:Zt,doubleLineOps:Dt};function mt(a,t,e,s,n){return{type:"path",ops:L(a,t,e,s,n)}}function I(a,t,e){const s=(a||[]).length;if(s>2){const n=[];for(let c=0;c<s-1;c++)n.push(...L(a[c][0],a[c][1],a[c+1][0],a[c+1][1],e));return t&&n.push(...L(a[s-1][0],a[s-1][1],a[0][0],a[0][1],e)),{type:"path",ops:n}}else if(s===2)return mt(a[0][0],a[0][1],a[1][0],a[1][1],e);return{type:"path",ops:[]}}function $t(a,t){return I(a,!0,t)}function Vt(a,t,e,s,n){const c=[[a,t],[a+e,t],[a+e,t+s],[a,t+s]];return $t(c,n)}function rt(a,t){if(a.length){const s=typeof a[0][0]=="number"?[a]:a,n=F(s[0],1*(1+t.roughness*.2),t),c=t.disableMultiStroke?[]:F(s[0],1.5*(1+t.roughness*.22),lt(t));for(let r=1;r<s.length;r++){const o=s[r];if(o.length){const l=F(o,1*(1+t.roughness*.2),t),i=t.disableMultiStroke?[]:F(o,1.5*(1+t.roughness*.22),lt(t));for(const h of l)h.op!=="move"&&n.push(h);for(const h of i)h.op!=="move"&&c.push(h)}}return{type:"path",ops:n.concat(c)}}return{type:"path",ops:[]}}function Zt(a,t,e,s,n){const c=bt(e,s,n);return N(a,t,n,c).opset}function bt(a,t,e){const s=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(a/2,2)+Math.pow(t/2,2))/2)),n=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*s)),c=Math.PI*2/n;let r=Math.abs(a/2),o=Math.abs(t/2);const l=1-e.curveFitting;return r+=g(r*l,e),o+=g(o*l,e),{increment:c,rx:r,ry:o}}function N(a,t,e,s){const[n,c]=ut(s.increment,a,t,s.rx,s.ry,1,s.increment*G(.1,G(.4,1,e),e),e);let r=W(n,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[o]=ut(s.increment,a,t,s.rx,s.ry,1.5,0,e),l=W(o,null,e);r=r.concat(l)}return{estimatedPoints:c,opset:{type:"path",ops:r}}}function ht(a,t,e,s,n,c,r,o,l){const i=a,h=t;let u=Math.abs(e/2),f=Math.abs(s/2);u+=g(u*.01,l),f+=g(f*.01,l);let p=n,d=c;for(;p<0;)p+=Math.PI*2,d+=Math.PI*2;d-p>Math.PI*2&&(p=0,d=Math.PI*2);const M=Math.PI*2/l.curveStepCount,k=Math.min(M/2,(d-p)/2),m=ft(k,i,h,u,f,p,d,1,l);if(!l.disableMultiStroke){const b=ft(k,i,h,u,f,p,d,1.5,l);m.push(...b)}return r&&(o?m.push(...L(i,h,i+u*Math.cos(p),h+f*Math.sin(p),l),...L(i,h,i+u*Math.cos(d),h+f*Math.sin(d),l)):m.push({op:"lineTo",data:[i,h]},{op:"lineTo",data:[i+u*Math.cos(p),h+f*Math.sin(p)]})),{type:"path",ops:m}}function it(a,t){const e=Mt(gt(K(a))),s=[];let n=[0,0],c=[0,0];for(const{key:r,data:o}of e)switch(r){case"M":{c=[o[0],o[1]],n=[o[0],o[1]];break}case"L":s.push(...L(c[0],c[1],o[0],o[1],t)),c=[o[0],o[1]];break;case"C":{const[l,i,h,u,f,p]=o;s.push(...Qt(l,i,h,u,f,p,c,t)),c=[f,p];break}case"Z":s.push(...L(c[0],c[1],n[0],n[1],t)),c=[n[0],n[1]];break}return{type:"path",ops:s}}function B(a,t){const e=[];for(const s of a)if(s.length){const n=t.maxRandomnessOffset||0,c=s.length;if(c>2){e.push({op:"move",data:[s[0][0]+g(n,t),s[0][1]+g(n,t)]});for(let r=1;r<c;r++)e.push({op:"lineTo",data:[s[r][0]+g(n,t),s[r][1]+g(n,t)]})}}return{type:"fillPath",ops:e}}function z(a,t){return qt(t,Wt).fillPolygons(a,t)}function jt(a,t,e,s,n,c,r){const o=a,l=t;let i=Math.abs(e/2),h=Math.abs(s/2);i+=g(i*.01,r),h+=g(h*.01,r);let u=n,f=c;for(;u<0;)u+=Math.PI*2,f+=Math.PI*2;f-u>Math.PI*2&&(u=0,f=Math.PI*2);const p=(f-u)/r.curveStepCount,d=[];for(let M=u;M<=f;M=M+p)d.push([o+i*Math.cos(M),l+h*Math.sin(M)]);return d.push([o+i*Math.cos(f),l+h*Math.sin(f)]),d.push([o,l]),z([d],r)}function Ht(a,t){return g(a,t)}function Bt(a,t,e){return G(a,t,e)}function Dt(a,t,e,s,n){return L(a,t,e,s,n,!0)}function lt(a){const t=Object.assign({},a);return t.randomizer=void 0,a.seed&&(t.seed=a.seed+1),t}function yt(a){return a.randomizer||(a.randomizer=new Ft(a.seed||0)),a.randomizer.next()}function G(a,t,e,s=1){return e.roughness*s*(yt(e)*(t-a)+a)}function g(a,t,e=1){return G(-a,a,t,e)}function L(a,t,e,s,n,c=!1){const r=c?n.disableMultiStrokeFill:n.disableMultiStroke,o=Y(a,t,e,s,n,!0,!1);if(r)return o;const l=Y(a,t,e,s,n,!0,!0);return o.concat(l)}function Y(a,t,e,s,n,c,r){const o=Math.pow(a-e,2)+Math.pow(t-s,2),l=Math.sqrt(o);let i=1;l<200?i=1:l>500?i=.4:i=-.0016668*l+1.233334;let h=n.maxRandomnessOffset||0;h*h*100>o&&(h=l/10);const u=h/2,f=.2+yt(n)*.2;let p=n.bowing*n.maxRandomnessOffset*(s-t)/200,d=n.bowing*n.maxRandomnessOffset*(a-e)/200;p=g(p,n,i),d=g(d,n,i);const M=[],k=()=>g(u,n,i),m=()=>g(h,n,i),b=n.preserveVertices;return r?M.push({op:"move",data:[a+(b?0:k()),t+(b?0:k())]}):M.push({op:"move",data:[a+(b?0:g(h,n,i)),t+(b?0:g(h,n,i))]}),r?M.push({op:"bcurveTo",data:[p+a+(e-a)*f+k(),d+t+(s-t)*f+k(),p+a+2*(e-a)*f+k(),d+t+2*(s-t)*f+k(),e+(b?0:k()),s+(b?0:k())]}):M.push({op:"bcurveTo",data:[p+a+(e-a)*f+m(),d+t+(s-t)*f+m(),p+a+2*(e-a)*f+m(),d+t+2*(s-t)*f+m(),e+(b?0:m()),s+(b?0:m())]}),M}function F(a,t,e){if(!a.length)return[];const s=[];s.push([a[0][0]+g(t,e),a[0][1]+g(t,e)]),s.push([a[0][0]+g(t,e),a[0][1]+g(t,e)]);for(let n=1;n<a.length;n++)s.push([a[n][0]+g(t,e),a[n][1]+g(t,e)]),n===a.length-1&&s.push([a[n][0]+g(t,e),a[n][1]+g(t,e)]);return W(s,null,e)}function W(a,t,e){const s=a.length,n=[];if(s>3){const c=[],r=1-e.curveTightness;n.push({op:"move",data:[a[1][0],a[1][1]]});for(let o=1;o+2<s;o++){const l=a[o];c[0]=[l[0],l[1]],c[1]=[l[0]+(r*a[o+1][0]-r*a[o-1][0])/6,l[1]+(r*a[o+1][1]-r*a[o-1][1])/6],c[2]=[a[o+1][0]+(r*a[o][0]-r*a[o+2][0])/6,a[o+1][1]+(r*a[o][1]-r*a[o+2][1])/6],c[3]=[a[o+1][0],a[o+1][1]],n.push({op:"bcurveTo",data:[c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]]})}}else s===3?(n.push({op:"move",data:[a[1][0],a[1][1]]}),n.push({op:"bcurveTo",data:[a[1][0],a[1][1],a[2][0],a[2][1],a[2][0],a[2][1]]})):s===2&&n.push(...Y(a[0][0],a[0][1],a[1][0],a[1][1],e,!0,!0));return n}function ut(a,t,e,s,n,c,r,o){const l=o.roughness===0,i=[],h=[];if(l){a=a/4,h.push([t+s*Math.cos(-a),e+n*Math.sin(-a)]);for(let u=0;u<=Math.PI*2;u=u+a){const f=[t+s*Math.cos(u),e+n*Math.sin(u)];i.push(f),h.push(f)}h.push([t+s*Math.cos(0),e+n*Math.sin(0)]),h.push([t+s*Math.cos(a),e+n*Math.sin(a)])}else{const u=g(.5,o)-Math.PI/2;h.push([g(c,o)+t+.9*s*Math.cos(u-a),g(c,o)+e+.9*n*Math.sin(u-a)]);const f=Math.PI*2+u-.01;for(let p=u;p<f;p=p+a){const d=[g(c,o)+t+s*Math.cos(p),g(c,o)+e+n*Math.sin(p)];i.push(d),h.push(d)}h.push([g(c,o)+t+s*Math.cos(u+Math.PI*2+r*.5),g(c,o)+e+n*Math.sin(u+Math.PI*2+r*.5)]),h.push([g(c,o)+t+.98*s*Math.cos(u+r),g(c,o)+e+.98*n*Math.sin(u+r)]),h.push([g(c,o)+t+.9*s*Math.cos(u+r*.5),g(c,o)+e+.9*n*Math.sin(u+r*.5)])}return[h,i]}function ft(a,t,e,s,n,c,r,o,l){const i=c+g(.1,l),h=[];h.push([g(o,l)+t+.9*s*Math.cos(i-a),g(o,l)+e+.9*n*Math.sin(i-a)]);for(let u=i;u<=r;u=u+a)h.push([g(o,l)+t+s*Math.cos(u),g(o,l)+e+n*Math.sin(u)]);return h.push([t+s*Math.cos(r),e+n*Math.sin(r)]),h.push([t+s*Math.cos(r),e+n*Math.sin(r)]),W(h,null,l)}function Qt(a,t,e,s,n,c,r,o){const l=[],i=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.3];let h=[0,0];const u=o.disableMultiStroke?1:2,f=o.preserveVertices;for(let p=0;p<u;p++)p===0?l.push({op:"move",data:[r[0],r[1]]}):l.push({op:"move",data:[r[0]+(f?0:g(i[0],o)),r[1]+(f?0:g(i[0],o))]}),h=f?[n,c]:[n+g(i[p],o),c+g(i[p],o)],l.push({op:"bcurveTo",data:[a+g(i[p],o),t+g(i[p],o),e+g(i[p],o),s+g(i[p],o),h[0],h[1]]});return l}function T(a){return[...a]}function pt(a,t=0){const e=a.length;if(e<3)throw new Error("A curve must have at least three points.");const s=[];if(e===3)s.push(T(a[0]),T(a[1]),T(a[2]),T(a[2]));else{const n=[];n.push(a[0],a[0]);for(let o=1;o<a.length;o++)n.push(a[o]),o===a.length-1&&n.push(a[o]);const c=[],r=1-t;s.push(T(n[0]));for(let o=1;o+2<n.length;o++){const l=n[o];c[0]=[l[0],l[1]],c[1]=[l[0]+(r*n[o+1][0]-r*n[o-1][0])/6,l[1]+(r*n[o+1][1]-r*n[o-1][1])/6],c[2]=[n[o+1][0]+(r*n[o][0]-r*n[o+2][0])/6,n[o+1][1]+(r*n[o][1]-r*n[o+2][1])/6],c[3]=[n[o+1][0],n[o+1][1]],s.push(c[1],c[2],c[3])}}return s}function Nt(a,t){return Math.sqrt(R(a,t))}function R(a,t){return Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)}function Yt(a,t,e){const s=R(t,e);if(s===0)return R(a,t);let n=((a[0]-t[0])*(e[0]-t[0])+(a[1]-t[1])*(e[1]-t[1]))/s;return n=Math.max(0,Math.min(1,n)),R(a,w(t,e,n))}function w(a,t,e){return[a[0]+(t[0]-a[0])*e,a[1]+(t[1]-a[1])*e]}function Xt(a,t){const e=a[t+0],s=a[t+1],n=a[t+2],c=a[t+3];let r=3*s[0]-2*e[0]-c[0];r*=r;let o=3*s[1]-2*e[1]-c[1];o*=o;let l=3*n[0]-2*c[0]-e[0];l*=l;let i=3*n[1]-2*c[1]-e[1];return i*=i,r<l&&(r=l),o<i&&(o=i),r+o}function X(a,t,e,s){const n=s||[];if(Xt(a,t)<e){const c=a[t+0];n.length?Nt(n[n.length-1],c)>1&&n.push(c):n.push(c),n.push(a[t+3])}else{const r=a[t+0],o=a[t+1],l=a[t+2],i=a[t+3],h=w(r,o,.5),u=w(o,l,.5),f=w(l,i,.5),p=w(h,u,.5),d=w(u,f,.5),M=w(p,d,.5);X([r,h,p,M],0,e,n),X([M,d,f,i],0,e,n)}return n}function Ut(a,t){return $(a,0,a.length,t)}function $(a,t,e,s,n){const c=n||[],r=a[t],o=a[e-1];let l=0,i=1;for(let h=t+1;h<e-1;++h){const u=Yt(a[h],r,o);u>l&&(l=u,i=h)}return Math.sqrt(l)>s?($(a,t,i+1,s,c),$(a,i,e,s,c)):(c.length||c.push(r),c.push(o)),c}function U(a,t=.15,e){const s=[],n=(a.length-1)/3;for(let c=0;c<n;c++){const r=c*3;X(a,r,t,s)}return e&&e>0?$(s,0,s.length,e):s}function Jt(a,t,e){const s=K(a),n=Mt(gt(s)),c=[];let r=[],o=[0,0],l=[];const i=()=>{l.length>=4&&r.push(...U(l,t)),l=[]},h=()=>{i(),r.length&&(c.push(r),r=[])};for(const{key:f,data:p}of n)switch(f){case"M":h(),o=[p[0],p[1]],r.push(o);break;case"L":i(),r.push([p[0],p[1]]);break;case"C":if(!l.length){const d=r.length?r[r.length-1]:o;l.push([d[0],d[1]])}l.push([p[0],p[1]]),l.push([p[2],p[3]]),l.push([p[4],p[5]]);break;case"Z":i(),r.push([o[0],o[1]]);break}if(h(),!e)return c;const u=[];for(const f of c){const p=Ut(f,e);p.length&&u.push(p)}return u}const S="none";class Kt{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Et()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}line(t,e,s,n,c){const r=this._o(c);return this._d("line",[mt(t,e,s,n,r)],r)}rectangle(t,e,s,n,c){const r=this._o(c),o=[],l=Vt(t,e,s,n,r);if(r.fill){const i=[[t,e],[t+s,e],[t+s,e+n],[t,e+n]];r.fillStyle==="solid"?o.push(B([i],r)):o.push(z([i],r))}return r.stroke!==S&&o.push(l),this._d("rectangle",o,r)}ellipse(t,e,s,n,c){const r=this._o(c),o=[],l=bt(s,n,r),i=N(t,e,r,l);if(r.fill)if(r.fillStyle==="solid"){const h=N(t,e,r,l).opset;h.type="fillPath",o.push(h)}else o.push(z([i.estimatedPoints],r));return r.stroke!==S&&o.push(i.opset),this._d("ellipse",o,r)}circle(t,e,s,n){const c=this.ellipse(t,e,s,s,n);return c.shape="circle",c}linearPath(t,e){const s=this._o(e);return this._d("linearPath",[I(t,!1,s)],s)}arc(t,e,s,n,c,r,o=!1,l){const i=this._o(l),h=[],u=ht(t,e,s,n,c,r,o,!0,i);if(o&&i.fill)if(i.fillStyle==="solid"){const f=Object.assign({},i);f.disableMultiStroke=!0;const p=ht(t,e,s,n,c,r,!0,!1,f);p.type="fillPath",h.push(p)}else h.push(jt(t,e,s,n,c,r,i));return i.stroke!==S&&h.push(u),this._d("arc",h,i)}curve(t,e){const s=this._o(e),n=[],c=rt(t,s);if(s.fill&&s.fill!==S)if(s.fillStyle==="solid"){const r=rt(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(r.ops)})}else{const r=[],o=t;if(o.length){const i=typeof o[0][0]=="number"?[o]:o;for(const h of i)h.length<3?r.push(...h):h.length===3?r.push(...U(pt([h[0],h[0],h[1],h[2]]),10,(1+s.roughness)/2)):r.push(...U(pt(h),10,(1+s.roughness)/2))}r.length&&n.push(z([r],s))}return s.stroke!==S&&n.push(c),this._d("curve",n,s)}polygon(t,e){const s=this._o(e),n=[],c=I(t,!0,s);return s.fill&&(s.fillStyle==="solid"?n.push(B([t],s)):n.push(z([t],s))),s.stroke!==S&&n.push(c),this._d("polygon",n,s)}path(t,e){const s=this._o(e),n=[];if(!t)return this._d("path",n,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const c=s.fill&&s.fill!=="transparent"&&s.fill!==S,r=s.stroke!==S,o=!!(s.simplification&&s.simplification<1),l=o?4-4*(s.simplification||1):(1+s.roughness)/2,i=Jt(t,1,l),h=it(t,s);if(c)if(s.fillStyle==="solid")if(i.length===1){const u=it(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));n.push({type:"fillPath",ops:this._mergedShape(u.ops)})}else n.push(B(i,s));else n.push(z(i,s));return r&&(o?i.forEach(u=>{n.push(I(u,!1,s))}):n.push(h)),this._d("path",n,s)}opsToPath(t,e){let s="";for(const n of t.ops){const c=typeof e=="number"&&e>=0?n.data.map(r=>+r.toFixed(e)):n.data;switch(n.op){case"move":s+=`M${c[0]} ${c[1]} `;break;case"bcurveTo":s+=`C${c[0]} ${c[1]}, ${c[2]} ${c[3]}, ${c[4]} ${c[5]} `;break;case"lineTo":s+=`L${c[0]} ${c[1]} `;break}}return s.trim()}toPaths(t){const e=t.sets||[],s=t.options||this.defaultOptions,n=[];for(const c of e){let r=null;switch(c.type){case"path":r={d:this.opsToPath(c),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:S};break;case"fillPath":r={d:this.opsToPath(c),stroke:S,strokeWidth:0,fill:s.fill||S};break;case"fillSketch":r=this.fillSketch(c,s);break}r&&n.push(r)}return n}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||S,strokeWidth:s,fill:S}}_mergedShape(t){return t.filter((e,s)=>s===0?!0:e.op!=="move")}}export{Kt as R};
